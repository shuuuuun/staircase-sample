!function(t,e){"use strict";var i;return i={initialize:function(t){return this.settings=$.extend(i.defaults,t),i.Params=$.extend(i.Params,this.settings.params)}},t.Staircase=i,i.defaults={size:{width:640,height:640},trim_offset_top:176,trim_offset_left:0,trim_width:886,trim_height:236,eventNamespace:"Staircase",params:{},reUploadSize:640,debugMode:"debug"},i.API={upload:"http://example.com/"},i.Debug=function(){var t;return t=new RegExp("^\\?"+i.defaults.debugMode+"$"),t.test(location.search)}(),i.Util={},i.Params={resized_image_width:0,resized_image_height:0},i.UI={},i.UI.TRIM_OFFSET_TOP=i.defaults.trim_offset_top,i.UI.TRIM_OFFSET_LEFT=i.defaults.trim_offset_left,i.UI.TRIM_WIDTH=i.defaults.trim_width,i.UI.TRIM_HEIGHT=i.defaults.trim_height,i.UI.TRIM_RATIO=function(){return i.UI.TRIM_WIDTH/i.defaults.size}(),i.Events={CAMERA_SUCCESS:i.defaults.eventNamespace+"camera_success",CAMERA_ERROR:i.defaults.eventNamespace+"camera_error",UPLOAD_LOAD_IMG:i.defaults.eventNamespace+"upload_img_load",UPLOAD_READER:i.defaults.eventNamespace+"upload_reader",PREVIEW_SEND:i.defaults.eventNamespace+"preview_send",PREVIEW_CAMERA:i.defaults.eventNamespace+"preview_camera",PREVIEW_PHOTO:i.defaults.eventNamespace+"preview_photo",REUPLOAD_SUBMIT:i.defaults.eventNamespace+"reupload_submit",REUPLOAD_SUCCESS:i.defaults.eventNamespace+"reupload_success",REUPLOAD_ERROR:i.defaults.eventNamespace+"reupload_error",CHECK_PROCESS:i.defaults.eventNamespace+"check_process",CHECK_COMPLETE:i.defaults.eventNamespace+"check_complete",CHECK_ERROR:i.defaults.eventNamespace+"check_error",MODAL_SHOW:i.defaults.eventNamespace+"modal_show",MODAL_HIDE:i.defaults.eventNamespace+"modal_hide",TRANSFORM_LOAD_IMG:i.defaults.eventNamespace+"transform_img_load",TRANSFORM_MOVE_START:i.defaults.eventNamespace+"transform_move_start",TRANSFORM_MOVE:i.defaults.eventNamespace+"transform_move",TRANSFORM_MOVE_END:i.defaults.eventNamespace+"transform_move_end",TRANSFORM_SCALE:i.defaults.eventNamespace+"transform_scale",DND_LOAD_IMG:i.defaults.eventNamespace+"draganddrop_img_load",DND_SELECT:i.defaults.eventNamespace+"draganddrop_select",DND_DROP:i.defaults.eventNamespace+"draganddrop_droped",DND_READ:i.defaults.eventNamespace+"draganddrop_read"},i.Error={code:{0:"0",2:"2"},text:{0:"エラーテキスト1",2:"エラーテキスト2"}}}(window,window.document),function(t,e){"use strict";var i,n,r,s,o,a,u;return n=Staircase.Util,i=Staircase.Params,u=navigator.userAgent.toLowerCase(),n.ua={},n.ua.browser=u,n.ua.isIOS=/(iphone|ipod|ipad)/.test(u),n.ua.isAndroid=/(android)/.test(u),n.ua.isMobile=n.ua.isIOS||n.ua.isAndroid,s=function(){var e,i,n,r,s,o,a,u,c;if(c={},1<t.location.search.length)for(a=t.location.search.substring(1),o=a.split("&"),i=n=0,u=o.length;u>=0?u>n:n>u;i=u>=0?++n:--n)e=o[i].split("="),r=decodeURIComponent(e[0]),s=decodeURIComponent(e[1]),c[r]=s;return c},n.getQueryString=s,o=function(e){return t.JSON&&t.JSON.parse?t.JSON.parse(e+""):void 0},n.parseJSON=o,a=function(t,e){return i[t]=e},n.setParam=a,r=function(t,e){if(null!=i[t]&&null!=i[t][e])return i[t][e];throw new Error("Error Staircase.Params in key or value => key: "+t+", value: "+e)},n.getParam=r}(window,window.document);var extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"use strict";var i,n;return n=Staircase.Events,i=function(t){function e(t){e.__super__.constructor.call(this,t),this.initialize(t)}return extend(e,t),e.prototype.initialize=function(t){var e,i,r,s,o,a,u,c;return c=$(t)[0],navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,u=!1,s=function(t){return function(e){return u=!0,c.src=window.URL.createObjectURL(e),c.play(),t.powerOff=function(){var t;return t=e.getTracks()[0],t.stop(),u=!1},t.emit(n.CAMERA_SUCCESS,e)}}(this),r=function(t){return function(e){return u=!1,t.emit(n.CAMERA_ERROR,e)}}(this),a=function(t){return function(){return navigator.getUserMedia({video:!0,audio:!1},s,r)}}(this),o=function(){return navigator.getUserMedia}(),e=function(){return u},i=function(){return c},this.powerOn=a,this.powerOff=function(){},this.isSupport=o,this.getStatus=e,this.getVideo=i},e}(EventEmitter2),Staircase.Camera=i}(window,window.document);var extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"use strict";var i,n,r;return r=Staircase.UI,n=Staircase.Events,i=function(i){function r(t){r.__super__.constructor.call(this,t),this.initialize(t)}return extend(r,i),r.prototype.initialize=function(i){var r,s,o,a,u,c,h,l,p;return p=this,h=$(i)[0],l=e.getElementById("File"),u=function(t){var e,i,r,s;for(i=t.target.files,r=0,s=i.length;s>r;r++)e=i[r],e.type.match("image.*")&&a(e);return p.emit(n.DND_SELECT,i)},s=function(t){return t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},o=function(t){var e,i,r,s;for(t.stopPropagation(),t.preventDefault(),i=t.dataTransfer.files,r=0,s=i.length;s>r;r++)e=i[r],e.type.match("image.*")&&a(e);return p.emit(n.DND_DROP,t,i)},a=function(t){var e,i,r;return e={},i=new Image,i.onload=function(t){return p.emit(n.DND_LOAD_IMG,t,this,e)},r=new FileReader,r.onload=function(t){return function(r){return e=t,i.src=r.target.result,p.emit(n.DND_READ,r,r.target.result,e)}}(t),r.readAsDataURL(t)},c=function(){var e;return e=null!=t.File&&null!=t.FileReader&&null!=t.FileList&&null!=t.Blob}(),r=function(){return draggable},null!=l&&l.addEventListener("change",u,!1),h.addEventListener("dragover",s,!1),h.addEventListener("drop",o,!1),this.isSupport=c,this.getDragElement=r},r}(EventEmitter2),Staircase.DragAndDrop=i}(window,window.document);var extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"use strict";var i,n,r;return i=Staircase.Events,n=function(t){function e(t){e.__super__.constructor.call(this,t),this.initialize(t)}return extend(e,t),e.prototype.initialize=function(t){var e,n,r,s,o,a,u,c,h;return c=this,s=$(t)[0],e=s.getContext?s.getContext("2d"):null,n=function(){return s.width=0,s.height=0},n(),r=function(){var t,e,i,n,r,o;for(t=s.toDataURL("image/png"),e=atob(t.replace(/^.*,/,"")),i=new Uint8Array(e.length),n=r=0,o=e.length;o>=0?o>r:r>o;n=o>=0?++r:--r)i[n]=e.charCodeAt(n);return i},h=function(){return c.emit(i.PREVIEW_SEND)},o=function(t,i,n){var r,o,a,u;return null!=i||null!=n?(u=i,r=n):(a=t.videoWidth||t.width,o=t.videoHeight||t.height,u=Staircase.settings.size.width<a?Staircase.settings.size.width:a,r=Staircase.settings.size.height<o?Staircase.settings.size.height:o),s.width=u,s.height=r,e.drawImage(t,0,0,u,r)},u=function(){return s},a=function(){var t,e;return e=r(),t=new Blob([e.buffer],{type:"image/png"}),h(),t},this.wrap=h,this.draw=o,this.getCanvas=u,this.getBlob=a,this.reset=n},e}(EventEmitter2),Staircase.PreviewCanvas=n,r=function(t){function e(t){e.__super__.constructor.call(this,t),this.$el=$(t),this.el=this.$el[0],this.img=new Image,this.initialize()}return extend(e,t),e.prototype.initialize=function(){var t,e,i,n;return e=function(t){return this.img.src="http://"+t,this.el.appendChild(this.img)},n=function(){return this.el.style.display="block"},t=function(){return this.el.style.display="none"},i=function(){return this.hide(),this.el.removeChild(this.img)},this.render=e,this.show=n,this.hide=t,this.reset=i},e}(EventEmitter2),Staircase.PreviewImage=r}(window,window.document);var extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"use strict";var i,n;return i=Staircase.Events,n=function(t){function e(t){e.__super__.constructor.call(this,t),this.initialize()}return extend(e,t),e.prototype.initialize=function(){var t,e,n,r,s,o,a,u;return o=this,s=!1,a=null,u="",e=function(t){return u=t,this},n=function(){return s=!1,a=setInterval(function(){return $.ajax({type:"GET",url:u,dataType:"jsonp",jsonpCallback:"callback"}).done(function(t){return t.is_recogition_finished===!0?(r(),s=!0,o.emit(i.CHECK_COMPLETE,t)):t.is_recogition_finished===!1?o.emit(i.CHECK_PROCESS,t):void 0})},1e3)},r=function(){return clearInterval(a),a=null},t=function(){return s},this.set=e,this.start=n,this.stop=r,this.getStatus=t},e}(EventEmitter2),Staircase.ProcessChecker=n}(window,window.document);var extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"use strict";var i,n,r,s,o;return i=Staircase.Events,o=Staircase.Util,s=Staircase.UI,n=640,r=function(t){function e(t){e.__super__.constructor.call(this,t),this.size=t.size||n,this.expansion=n/this.size,this.initialize(),this.eventify()}return extend(e,t),e.prototype.initialize=function(){return this.$form=$("#Adjust"),this.$imageFrame=$(".transform__image"),this.$image=$("img",this.$imageFrame)},e.prototype.eventify=function(){return this.$form.on("submit",function(t){return function(e){return e.preventDefault(),t.submit()}}(this))},e.prototype.submit=function(){var t,e;return e=this.$image.width()/this.size+(s.TRIM_RATIO-1),t={image_uuid:o.getParam("upload","image_uuid"),zoom:e,x:s.TRIM_OFFSET_LEFT*s.TRIM_RATIO+Math.abs(this.$imageFrame.position().left)*this.expansion,y:s.TRIM_OFFSET_TOP*s.TRIM_RATIO+Math.abs(this.$imageFrame.position().top)*this.expansion,width:s.TRIM_WIDTH,height:s.TRIM_HEIGHT},this.emit(i.REUPLOAD_SUBMIT,t),$.ajax({type:"POST",url:this.$form.attr("action"),data:t}).done(function(t){return function(e){return t.emit(i.REUPLOAD_SUCCESS,e)}}(this)).fail(function(t){return function(e){return t.emit(i.REUPLOAD_ERROR,e)}}(this))},e}(EventEmitter2),Staircase.ReUploader=r}(window,window.document);var extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"use strict";var i,n,r,s;return i=Staircase.Debug,n=Staircase.Events,s=Staircase.Util,r=function(e){function r(t){r.__super__.constructor.call(this,t),this.$el=$(t),this.initialize()}return extend(r,e),r.prototype.initialize=function(e){var r,o,a,u,c,h,l,p,f;return f=this,o=this.$el.find('input[type="file"]'),r=this.$el.find("iframe"),l=null,a=function(t){var e,i;return i=new FileReader,e=t.target.files[0],i.onload=c,i.readAsDataURL(e)},c=function(t){return f.emit(n.UPLOAD_READER,t),l=new Image,l.onload=u,l.src=t.target.result},u=function(t){return f.emit(n.UPLOAD_LOAD_IMG,t,l)},h=function(e){return i?void r.attr({src:"/stub/_image.html",width:500,height:300}):s.ua.isMobile||!t.FileReader?f.$el.find("form").submit():a(e)},o.on("change",h),p=function(){return o.val(""),o.off("change"),o.parent().html(o.parent().html()),o=this.$el.find('input[type="file"]'),o.on("change",h)},this.reset=p},r}(EventEmitter2),Staircase.Uploader=r}(window,window.document);var extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"use strict";var i,n,r,s;return i=Staircase.Events,r=function(t){function e(t){e.__super__.constructor.call(this,t),this.$el=$(t),this.$icon=this.$el.find(".loading__icon"),this.initialize(),this.eventify()}return extend(e,t),e.prototype.initialize=function(){var t,e;return t=function(t){return function(){return t.$icon.addClass("is-active"),t.emit(i.LOADING_SHOW)}}(this),e=function(t){return function(){return t.$icon.removeClass("is-active"),t.emit(i.LOADING_HIDE)}}(this),this.start=t,this.stop=e},e.prototype.eventify=function(){},e}(EventEmitter2),Staircase.Loading=r,s=function(t){function e(t){e.__super__.constructor.call(this,t),this.$el=$(t),this.$icon=$(".loading__icon",this.$el),this.defaultClass=this.$icon.attr("class"),this.initialize(),this.eventify()}return extend(e,t),e.prototype.initialize=function(){var t,e,n,r,s,o,a;return a=null,s=40,r=0,o=36,t=function(t){return function(){return a=setInterval(function(){return r++,t.$icon[0].className=t.defaultClass+" loading-n"+r,r>=o?r=0:void 0},s)}}(this),e=function(e){return function(){return e.$el.show(),t(),e.emit(i.LOADING_START)}}(this),n=function(t){return function(){return t.$el.hide(),a=clearInterval(a),a=null,t.emit(i.LOADING_STOP)}}(this),this.start=e,this.stop=n},e.prototype.eventify=function(){},e}(EventEmitter2),Staircase.LoadingSprite=s,n=function(t){function e(t){e.__super__.constructor.call(this,t),this.$el=$(t),this.$icon=this.$el.find(".loading__icon"),this.initialize()}return extend(e,t),e.prototype.initialize=function(){var t,e,i,n;return n=function(t){return function(){return t.$el.removeClass("is-hidden"),t}}(this),i=function(t){return function(){return t.$el.addClass("is-hidden"),t}}(this),t=function(t){return function(){return t.$icon.addClass("is-active"),t}}(this),e=function(t){return function(){return t.$icon.removeClass("is-active"),t}}(this),this.show=n,this.hide=i,this.active=t,this.deactive=e},e}(EventEmitter2),Staircase.Exchange=n}(window,window.document);var extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"use strict";var i,n;return i=Staircase.Events,n=function(e){function n(e){n.__super__.constructor.call(this,e),this.$el=$(e.id),this.$page=$(e.page),this.$win=$(t),this.winHeight=this.$win.height(),this.currentScroll=0,this.initialize(),this.eventify()}return extend(n,e),n.prototype.initialize=function(){var t,e;return e=function(t){return function(){return t._fixed(),t.$el.show(),t.emit(i.MODAL_SHOW)}}(this),t=function(t){return function(){return t._static(),t.$el.hide(),t.emit(i.MODAL_HIDE)}}(this),this.show=e,this.hide=t},n.prototype.eventify=function(){return this.$el.on("click",".modal__bg, .modal__close",function(t){return function(e){return t.hide()}}(this))},n.prototype._fixed=function(){var t;return t=-1*this.$win.scrollTop(),this.currentScroll=this.$win.scrollTop(),this.$page.addClass("is-fixed").css("top",t),this.$el.css({position:"relative",height:this.winHeight}),this.$win.scrollTop(0)},n.prototype._static=function(){var t;return t=-1*this.$win.scrollTop(),this.$page.removeClass("is-fixed").css("top",""),this.$el.css({position:"",height:"auto"}),this.$win.scrollTop(this.currentScroll)},n}(EventEmitter2),Staircase.Modal=n}(window,window.document);var extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"use strict";var i,n;return i=Staircase.Events,n=function(t){function e(t){e.__super__.constructor.call(this,t),this.scenes=t||[],this.current=0,this.active(this.current)}return extend(e,t),e.prototype.add=function(t){return this.scenes.push(t)},e.prototype.active=function(t,e){var i,n,r,s,o;for(i=null!=t?t:this.current,n=r=0,s=this.scenes.length;s>=0?s>r:r>s;n=s>=0?++r:--r)o=this.scenes[n],n===i?o.active():o.deactive();return this.current=i,this.emit("sceneManager.active",null,this.current)},e.prototype.deactive=function(t){var e;return e=null!=t?t:this.current,this.scenes[t].deactive(),this.current=e,this.emit("sceneManager.deactive",null,this.current)},e.prototype.reset=function(){var t,e,i,n;for(this.current=0,t=e=0,i=this.scene.length;i>=0?i>e:e>i;t=i>=0?++e:--e)n=this.scene[t],n.deactive();return this.scenes=[]},e.prototype.first=function(){return this.scenes[0]},e.prototype.last=function(){return this.scenes[this.scenes.length-1]},e.prototype.isFirst=function(){return 0===this.current},e.prototype.isLast=function(){return this.current===this.scenes.length-1},e.prototype.prev=function(){return this.hasPrev()?this.active(--this.current):void 0},e.prototype.next=function(){return this.hasNext()?this.active(++this.current):void 0},e.prototype.hasPrev=function(){return 0<=this.current-1},e.prototype.hasNext=function(){return this.scenes.length>this.current+1},e}(EventEmitter2),Staircase.SceneManager=n}(window,window.document);var extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"use strict";var i,n;return i=Staircase.Events,n=function(t){function e(t){e.__super__.constructor.call(this,t),this.el=$(t)[0],this.items=[],this.initialize()}return extend(e,t),e.prototype.initialize=function(){},e.prototype.add=function(t){return this.items.push(t),this.emit("scene.add",t,this)},e.prototype.active=function(){var t,e,i,n;if(this.items.length>0)for(n=this.items,t=0,i=n.length;i>t;t++)e=n[t],e.show();return this.el.style.display="block",this.emit("scene.active",this)},e.prototype.deactive=function(){var t,e,i,n;if(this.items.length>0)for(n=this.items,t=0,i=n.length;i>t;t++)e=n[t],e.hide();return this.el.style.display="none",this.emit("scene.deactive",this)},e}(EventEmitter2),Staircase.Scene=n}(window,window.document);var extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"use strict";var i,n,r,s;return i=Staircase.Events,s=Staircase.Util,n=Staircase.Params,s.ua.isMobile?(i.CLICK="touchend",i.START="touchstart",i.MOVE="touchmove",i.END="touchend"):(i.CLICK="click",i.START="mousedown",i.MOVE="mousemove",i.END="mouseup"),r=function(t){function e(t){e.__super__.constructor.call(this,t),this.$imageFrame=$(".transform__image"),this.$image=$("img",this.$imageFrame),this.ratio=10,this.initialize()}return extend(e,t),e.prototype.initialize=function(){return this.$image.data("baseWidth",this.$image.width()),this.$image.data("baseHeight",this.$image.height())},e.prototype.scale=function(t,e){var r,s,o,a,u,c,h,l;return t.preventDefault(),r=parseInt(this.$imageFrame.css("left"),10),s=parseInt(this.$imageFrame.css("top"),10),o=this.$image.offset().left,u=this.$image.offset().top,l=10,a=o+this.$image.width()/l/2,c=u-this.$image.height()/l/2,this.ratio>=3*l&&e>0?this.ratio=3*l:this.ratio<=l&&0>e?this.ratio=l:(this.ratio+=e*l,r-=n.resized_image_width*e/2,s-=n.resized_image_height*e/2),h=this.resize({top:s,left:r,ratio:this.ratio}),this.emit(i.TRANSFORM_SCALE,h)},e.prototype.resize=function(t){var e,i,r,s,o,a;return a=n.resized_image_width*t.ratio/10,e=n.resized_image_height*t.ratio/10,o=0,i=0,s=function(t){return function(t){return t.css({width:a,height:e})}}(this),r=function(e,n,r){return o=t.top+r,i=t.left+n,e.css({left:i,top:o})},s(this.$image),r(this.$imageFrame,0,0),{width:a,height:e,top:o,left:i,ratio:t.ratio}},e.prototype.getDistance=function(t){return Math.sqrt(Math.pow(Number(t.originalEvent.touches[0].pageX)-Number(t.originalEvent.touches[1].pageX),2)+Math.pow(Number(t.originalEvent.touches[0].pageY)-Number(t.originalEvent.touches[1].pageY),2))},e.prototype.getRatio=function(){return this.ratio},e.prototype.reset=function(){return this.ratio=10,this.$image.css({width:"",height:""}),this.$imageFrame.css({left:0,top:0}),this.$image.data("baseWidth",null),this.$image.data("baseHeight",null)},e}(EventEmitter2),Staircase.Scale=r}(window,window.document);var extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"use strict";var i,n,r,s;return i=Staircase.Events,s=Staircase.Util,n=Staircase.Params,s.ua.isMobile?(i.CLICK="touchend",i.START="touchstart",i.MOVE="touchmove",i.END="touchend"):(i.CLICK="click",i.START="mousedown",i.MOVE="mousemove",i.END="mouseup"),r=function(t){function r(t){r.__super__.constructor.call(this,t),this.settings=t,this.$el=$(this.settings.transform),this.isLoaded=!1,this.initialize(),this.eventify()}return extend(r,t),r.prototype.initialize=function(){var t,e,r,o,a,u,c,h,l,p,f,d,m;return d=this,this.translate=null,this.scale=null,this.$dragArea=$(this.settings.transformDrag),this.$btnUp=$(this.settings.btnUp),this.$btnDown=$(this.settings.btnDown),this.$btnLeft=$(this.settings.btnLeft),this.$btnRight=$(this.settings.btnRight),this.$btnZoomIn=$(this.settings.btnZoomIn),this.$btnZoomOut=$(this.settings.btnZoomOut),e=$(this.settings.transformImageWrap),t=e.find("img"),t.css({width:"auto",height:"auto"}),a=e.width(),o=e.height(),c=10,l=function(t){var e,i,r;return r=t.width(),i=t.height(),e=r/i,n.resized_image_width=a,n.resized_image_height=n.resized_image_width/e,n.resized_image_height<o&&(n.resized_image_height=o,n.resized_image_width=n.resized_image_height*e),t.css({width:n.resized_image_width,height:n.resized_image_height}),p(t)},p=function(t){return e.css({width:t.width(),height:t.height()})},f=function(t){return e.css({width:t.width(),height:t.height()})},r=function(t,e,i,n){var r,s;return s=(t.height()-e.height())/2,r=(t.width()-e.width())/2,t.css({top:-s+n,left:-r+i})},u=function(i){return function(){return null==i.translate?i.translate=new Staircase.Translate:i.translate.initialize(),null==i.scale?i.scale=new Staircase.Scale:i.scale.initialize(),l(t),r(e,e,0,0)}}(this),t.on("load",function(t){return function(){return u(),t.isLoaded=!0,t.emit(i.TRANSFORM_LOAD_IMG)}}(this)),m=function(e){return function(){return t.attr({src:s.getParam("upload","image_path")})}}(this),m(),h=function(t){return function(){return null!=t.translate&&(t.translate.reset(),t.translate.initialize()),null!=t.scale?(t.scale.reset(),t.scale.initialize()):void 0}}(this),this.setImage=m,this.reset=h},r.prototype.eventify=function(){var t,n,r,o;return this.isLoaded===!0?this.eventifyExt():this.on(i.TRANSFORM_LOAD_IMG,function(t){return function(){return t.eventifyExt()}}(this)),this.$dragArea.on(i.START,function(t){return function(e){return e.pageX||(e=event.touches[0]),t.translate.start(e)}}(this)),$(e).on(i.MOVE,function(t){return function(e){return null!=t.translate&&t.translate.flag===!0?(e.pageX||(e=event.touches[0]),t.translate.move(e)):void 0}}(this)),$(e).on(i.END,function(t){return function(e){return t.translate.end(e)}}(this)),s.ua.isMobile?(o=0,n=0,t=1,r=10,this.$dragArea.on("touchstart",function(t){return function(e){return e.preventDefault(),2===e.originalEvent.touches.length?o=t.scale.getDistance(e):void 0}}(this)),this.$dragArea.on("touchmove",function(t){return function(e){return 2===e.originalEvent.touches.length?(n=t.scale.getDistance(e),ratio*=n/o,t.scale.scale(e,ratio/10-1)):void 0}}(this))):void 0},r.prototype.eventifyExt=function(){return this.$btnZoomIn.on(i.CLICK,function(t){return function(e){return t.scale.scale(e,.2)}}(this)),this.$btnZoomOut.on(i.CLICK,function(t){return function(e){return t.scale.scale(e,-.2)}}(this)),this.$btnUp.on(i.CLICK,function(t){return function(){return t.translate.set(0,-10)}}(this)),this.$btnDown.on(i.CLICK,function(t){return function(){return t.translate.set(0,10)}}(this)),this.$btnLeft.on(i.CLICK,function(t){return function(){return t.translate.set(-10,0)}}(this)),this.$btnRight.on(i.CLICK,function(t){return function(){return t.translate.set(10,0)}}(this))},r}(EventEmitter2),Staircase.Transform=r}(window,window.document);var extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"use strict";var i,n,r,s;return i=Staircase.Events,s=Staircase.Util,n=Staircase.Params,s.ua.isMobile?(i.CLICK="touchend",i.START="touchstart",i.MOVE="touchmove",i.END="touchend"):(i.CLICK="click",i.START="mousedown",i.MOVE="mousemove",i.END="mouseup"),r=function(t){function e(t){e.__super__.constructor.call(this,t),this.$imageFrame=$(".transform__image"),this.$image=$("img",this.$imageFrame),this.location={},this.flag=!1,this.initialize()}return extend(e,t),e.prototype.initialize=function(){return this.imageFrameWidth=this.$imageFrame.width(),this.imageFrameHeight=this.$imageFrame.height(),this.location={top:this.$imageFrame.offset().top,bottom:this.$imageFrame.offset().top+this.imageFrameHeight,left:this.$imageFrame.offset().left,right:this.$imageFrame.offset().left+this.imageFrameWidth},this.$imageFrame.data({location:this.location}),this.framePosition={top:0,bottom:0,left:0,right:0}},e.prototype.adjust=function(t,e,i){return this.location.left<this.framePosition.left?t.css({left:0+e}):this.location.right>this.framePosition.right&&t.css({left:this.imageFrameWidth-this.$image.width()+e}),this.location.top<this.framePosition.top?t.css({top:0+i}):this.location.bottom>this.framePosition.bottom?t.css({top:this.imageFrameHeight-this.$image.height()+i}):void 0},e.prototype.start=function(t){return this.flag=!0,this.startX=t.pageX,this.startY=t.pageY,this.originalTop=parseInt(this.$imageFrame.css("top"),10),this.originalLeft=parseInt(this.$imageFrame.css("left"),10)},e.prototype.move=function(t){var e,i,n,r;return e=t.pageX,i=t.pageY,n=e-this.startX,r=i-this.startY,this.locate(this.$imageFrame,0,0,n,r)},e.prototype.locate=function(t,e,i,n,r){return t.css({left:this.originalLeft+n+e,top:this.originalTop+r+i})},e.prototype.end=function(t){return this.flag=!1,this.adjustPhotoLocation()},e.prototype.adjustPhotoLocation=function(){return this.framePosition={top:this.$imageFrame.offset().top,bottom:this.$imageFrame.offset().top+this.$image.height(),left:this.$imageFrame.offset().left,right:this.$imageFrame.offset().left+this.$image.width()},this.adjust(this.$imageFrame,0,0)},e.prototype.set=function(t,e){return this.originalTop=parseInt(this.$imageFrame.css("top"),10),this.originalLeft=parseInt(this.$imageFrame.css("left"),10),this.locate(this.$imageFrame,0,0,t,e),this.adjustPhotoLocation()},e.prototype.reset=function(){return this.location={},this.$imageFrame.css({left:0,top:0}),this.framePosition={top:0,bottom:0,left:0,right:0},this.$imageFrame.width(this.imageFrameWidth),this.$imageFrame.height(this.imageFrameHeight)},e}(EventEmitter2),Staircase.Translate=r}(window,window.document);