!function(e,a){var t=e.App=e.App||{},i=Staircase.Events;t.SetupStaircase=function(){Staircase.initialize(),this.initialize()},t.SetupStaircase.prototype.initialize=function(){this.camera=new Staircase.Camera("#Video"),this.previewCanvas=new Staircase.PreviewCanvas("#Canvas"),this.previewCanvas.type="camera",this.previewImage=new Staircase.PreviewCanvas("#CanvasDummy"),this.previewImage.type="file",this.dnd=new Staircase.DragAndDrop("#DragAndDrop"),this.modal=new Staircase.Modal({id:"#Modal",page:".container"}),this.$screenSelect=$("#screen-select"),this.$screenCamera=$("#screen-camera"),this.$screenUpload=$("#screen-upload"),this.$btnSelectCamera=this.$screenSelect.find(".btn-camera"),this.$btnSelectUpload=this.$screenSelect.find(".btn-upload"),this.$navigateUpload=this.$screenCamera.find(".btn-navigate-upload"),this.$navigateCamera=this.$screenUpload.find(".btn-navigate-camera"),this.$uploadForm=$("#UploadForm"),this.$btnStartCamera=$("#StartCamera"),this.$btnCapture=$("#CaptureBtn"),this.$btnUpload=$("#UploadBtn"),this.$inputUpload=this.$uploadForm.find('input[type="file"]'),this.$modalError=this.modal.$el.find(".modal__error"),this.modalCloseTargetSelector=".modal-bg, .btn-close";var e=Staircase.Util.getQueryString();"ng"===e.mp_status&&(this.$modalError.html("画像の処理に失敗しました。<br>別の画像をアップロードしてください。"),this.modal.show()),this.eventify()},t.SetupStaircase.prototype.eventify=function(){var e=this;null==this.camera.isSupport&&(this.$btnStartCamera.hide(),this.$navigateCamera.hide()),this.$btnCapture.on("click",function(a){a.preventDefault();var t=e.camera.getVideo();e.previewCanvas.draw(t),$(t).hide(),e.$btnCapture.attr("disabled",!0),e.camera.powerOff()}),this.$btnUpload.on("click",function(a){e.$btnUpload.attr("disabled",!0),e.$inputUpload.addClass("disabled"),e.$navigateCamera.hide(),e.$navigateUpload.hide()}),this.dnd.on(i.DND_LOAD_IMG,function(a,t,i){e.previewImage.draw(t,t.width,t.height)}),this.modal.$el.on("click",this.modalCloseTargetSelector,function(a){e.modal.hide()}),t.ua.isPC&&(this.$screenCamera.hide(),this.$screenUpload.hide(),this.$btnSelectCamera.on("click",function(a){e.switchScreenCamera()}),this.$btnSelectUpload.on("click",function(){e.switchScreenUpload()}),this.$navigateCamera.on("click",function(){e.switchScreenCamera()}),this.$navigateUpload.on("click",function(){e.switchScreenUpload()}))},t.SetupStaircase.prototype.switchScreenCamera=function(){this.$screenSelect.hide(),this.$screenUpload.hide(),this.camera.powerOn(),this.$screenCamera.show()},t.SetupStaircase.prototype.switchScreenUpload=function(){this.$screenSelect.hide(),this.$screenCamera.hide(),this.$screenCamera.find(".error").hide(),this.camera.powerOff(),this.$screenUpload.show()},t.SetupStaircase.prototype.postImage=function(e){var a,t,i,r;r=this,t=e.getCanvas(),a=t.toDataURL("image/png").replace(/^.*,/,""),i={img:a},Staircase.Util.ua.isIOS?i.device="ios":Staircase.Util.ua.isAndroid&&(i.device="android"),this.$modalError.attr("class","error"),$.ajax({url:"/face.json",method:"POST",data:i,beforeSend:function(){r.$btnCapture.attr("disabled",!0),r.$btnUpload.attr("disabled",!0),r.$navigateCamera.hide(),r.$navigateUpload.hide()},success:function(a){"ok"===a.status?$(location).attr("href",a.redirect_path):(r.$btnCapture.attr("disabled",!1),r.$btnUpload.attr("disabled",!1),r.$navigateCamera.show(),r.$navigateUpload.show(),"camera"===e.type?(e.reset(),r.camera.powerOn(),r.$modalError.html("画像の処理に失敗しました。<br>もう一度撮影し直してください。")):"file"===e.type&&r.$modalError.html("画像の処理に失敗しました。<br>別の画像をアップロードしてください。"),r.modal.show())},complete:function(){}})}}(this,document);