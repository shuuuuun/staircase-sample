!function(e,t){var a=e.App=e.App||{},i=Staircase.Events;a.SetupStaircase=function(){Staircase.initialize(),this.initialize()},a.SetupStaircase.prototype.initialize=function(){this.camera=new Staircase.Camera("#Video"),this.previewCanvas=new Staircase.PreviewCanvas("#PreviewVideo"),this.previewCanvas.type="camera",this.previewImage=new Staircase.PreviewCanvas("#PreviewImage"),this.previewImage.type="file",this.dnd=new Staircase.DragAndDrop("#DragAndDrop"),this.modal=new Staircase.Modal({id:"#Modal",page:".container"}),this.$camera=$("#Camera"),this.$previewVideo=$("#PreviewVideo"),this.$previewImage=$("#PreviewImage"),this.$screenSelect=$("#screen-select"),this.$screenCamera=$("#screen-camera"),this.$screenUpload=$("#screen-upload"),this.$btnNavigateCamera=$(".btn-navigate-camera"),this.$btnNavigateUpload=$(".btn-navigate-upload"),this.$btnCancel=$(".btn-cancel button"),this.$btnAgain=$(".btn-again button"),this.$btnCapture=$("#CaptureBtn"),this.$btnUpload=$(".btn-upload button"),this.$inputFile=$("#InputFile"),this.$modalError=this.modal.$el.find(".modal__error"),this.modalCloseTargetSelector=".modal-bg, .btn-close";var e=Staircase.Util.getQueryString();"ng"===e.mp_status&&(this.$modalError.html("画像の処理に失敗しました。<br>別の画像をアップロードしてください。"),this.modal.show()),this.eventify()},a.SetupStaircase.prototype.eventify=function(){var e=this;null==this.camera.isSupport&&this.$btnNavigateCamera.hide(),this.switchScreenSelect(),this.$btnNavigateCamera.on("click",function(t){e.switchScreenCamera()}),this.$btnNavigateUpload.on("click",function(){e.switchScreenUpload()}),this.$btnCancel.on("click",function(){e.switchScreenSelect()}),this.$btnAgain.on("click",function(){e.switchScreenCamera()}),this.$btnCapture.on("click",function(t){t.preventDefault();var a=e.camera.getVideo();e.previewCanvas.draw(a),e.$camera.hide(),e.camera.powerOff(),e.$previewVideo.show(),e.$btnCapture.attr("disabled",!0),e.$btnAgain.attr("disabled",!1),e.$btnUpload.attr("disabled",!1)}),this.$btnUpload.on("click",function(t){e.$btnUpload.attr("disabled",!0),e.$inputFile.addClass("disabled"),alert("アップロード！")}),window.URL=window.URL||window.webkitURL,this.$inputFile.on("change",function(t){for(var a=this.files,i=0;i<a.length;i++){var r=a[i],n=/image.*/;if(r.type.match(n)){var s=new Image;s.src=window.URL.createObjectURL(r),s.onload=function(t){e.previewImage.draw(s,s.width,s.height)}}}e.$btnUpload.attr("disabled",!1)}),this.dnd.on(i.DND_LOAD_IMG,function(t,a,i){e.previewImage.draw(a,a.width,a.height)}),this.modal.$el.on("click",this.modalCloseTargetSelector,function(t){e.modal.hide()})},a.SetupStaircase.prototype.switchScreenCamera=function(){this.$screenSelect.hide(),this.$screenUpload.hide(),this.$screenUpload.find(".error").hide(),this.$previewVideo.hide(),this.camera.powerOn(),this.$camera.show(),this.$btnAgain.attr("disabled",!0),this.$btnCapture.attr("disabled",!1),this.$screenCamera.show()},a.SetupStaircase.prototype.switchScreenUpload=function(){this.$screenSelect.hide(),this.$screenCamera.hide(),this.$screenCamera.find(".error").hide(),this.camera.powerOff(),this.$screenUpload.show()},a.SetupStaircase.prototype.switchScreenSelect=function(){this.$screenCamera.hide(),this.$screenUpload.hide(),this.$screenCamera.find(".error").hide(),this.$screenUpload.find(".error").hide(),this.camera.powerOff(),this.$screenSelect.show()},a.SetupStaircase.prototype.postImage=function(e){var t,a,i,r;r=this,a=e.getCanvas(),t=a.toDataURL("image/png").replace(/^.*,/,""),i={img:t},Staircase.Util.ua.isIOS?i.device="ios":Staircase.Util.ua.isAndroid&&(i.device="android"),this.$modalError.attr("class","error"),$.ajax({url:"/face.json",method:"POST",data:i,beforeSend:function(){r.$btnCapture.attr("disabled",!0),r.$btnUpload.attr("disabled",!0),r.$navigateCamera.hide(),r.$navigateUpload.hide()},success:function(t){"ok"===t.status?$(location).attr("href",t.redirect_path):(r.$btnCapture.attr("disabled",!1),r.$btnUpload.attr("disabled",!1),r.$navigateCamera.show(),r.$navigateUpload.show(),"camera"===e.type?(e.reset(),r.camera.powerOn(),r.$modalError.html("画像の処理に失敗しました。<br>もう一度撮影し直してください。")):"file"===e.type&&r.$modalError.html("画像の処理に失敗しました。<br>別の画像をアップロードしてください。"),r.modal.show())},complete:function(){}})}}(this,document);